Title: Sabayon on an Optimus System
Date: 2017-01-27 15:28
Category: Projects
slug: sabayon-on-optimus

#Trying [Sabayon](../sabayon-os.html)?

###What is an Optimus System?

Alright, so what is an optimus system right? Well the easy way to understand it is that it is a system that comes with a discrete Nvidia graphics card as well as an integrated Intel graphics card. Now typically on a windows system how these two work together is that for everything that is not graphics intensive, the Intel card does all of the work. However, when you are running something that needs alot of graphical capability, then the system switches over to the Nvidia card.

###Why is that important?
This is important to know when installing linux OS's on such a system. Nine times out of ten these kinds of systems dont like to play very nice with the linux distribution of your choice. In this case we will be working with Sabayon OS which is a branch off of Gentoo... Yes I said Gentoo. Now typically Sabayon is supposed to work out of the box, even with these kinds of systems as it has native Nvidia drivers. Sometimes though it doesnt work out so well. Another thing to keep in mind is that most likely how the Nvidia graphics card works is that when it is running a process it will then output that processto the Intel card, which will in turn output what it is given to the screen. This is where I ran into a problem.

###My fix.
So the system I was trying to install Sabayon on is an MSi ge62vr Apache pro-008, which is a gaming laptop. Now even though this was a great learning experience, if you arent going to buy a gaming laptop and stick with the native operating system just to play games on... DON'T BUY ONE! Again that is just an opinion and there are ways to make things work. Anyways, on to the question, how did I get it to work? When I initially plugged in my bootable usb drive with Sabayon 6.11(Gnome) on it, I click on start Sabayon. Instead of bringing me to the Gnome desktop it brought me straight to the tty and kept flashing the screen. Since I didnt know what was wrong at the time, I rebooted and selected the text based install option. This brought me back to the tty and the installation was pretty straight forward. After my install was completed I rebooted into the new system and yet again it brought me to a tty. Naturally I tried running `startx` which just gave me an error and told me to look into the log file located at `/var/log/Xorg.log`.

After looking at the log I initially found that it wasnt loading the  GLX drivers properly, so I went on to the Sabayon [Chat Support](https://www.sabayon.org/chat/) and started asking questions. Long story short they led me through various methods and suggested things such as blacklisting nouveau, and installing bumblebee, which is an open source program designed to work with optimus systems to switch graphics cards like the windows systems do. When I had tried the bumblebee option and started the service, as soon as I would run `startx` the system would freeze and so I would have to reboot and try and figure it out again. He also made sure that I ran `eselect open list` and `eselect opengl set ___` with the space being the option that pointed to `xorg-x11`. Now when we had gotten onto the bumblebee topic the person who was helping me had to leave so I was left on my own.

Now keep in mind, ,this was after like 3 days of troubleshooting and not being able to figure out what was going on, I even tried older versions of Sabayon and with different desktop environments. When I started to look into it on my own, I remembered the guy saying something about how the log file made no mention of my Intel card at all. So it got me thinking, maybe I needed to mess if the `xorg.conf` file, so I went in and changed the driver option from `nvidia` to `intel`. After I saved and exited the file I tried running `startx` again, this time it started, except it didnt bring me to lightdm or gdm or even sddm login managers it brought up a weird partly gui with three xterms open and all I could do was mess with those. I ended up just rebooting being taken back to the tty. After searching around I found that I should run `nvidia-xconfig`, after which I went back to the `xorg.conf` and redid my previous changes to the driver option. After that I kept searching and ended up uninstalling lightmd and sddm so that I would only have gdm on my machine and then ran `systemctl start gdm`. To my surprise, this worked, you have no idea how excited I was at the time. After messing around and setting up my new system, I realized it was kind of broken still with somethings, so I decided to uninstall the system and try to re-install Sabayon.

Instead of relying on the text based installer, which is lacking certain features such as hard disk encryption, I tried to boot to the liveCD. Again this brought me to a tty that was flashing, so I ran `systemctl stop gdm` which stopped the flashing so I could actually type and get work done. From there I ran `eselect opengl set ___` again to the `xord-x11` option. I then ran `nvidia-xconfig` and went into the `xorg.conf` and made the changes as before. I then tried `systemctl start gdm` and was able to boot into the liveCD successfully. I proceeded to install the system thinking that on reboot I would have to go through and reconfigure everything one last time, however on reboot I was brought directly to the gdm login screen and when I messed aroundn in the system, nothing seemed broken. Eventually after setting up everything I wanted I did realize that when I would try to drag icons to and from the favorites bar in Gnome it everything would stop and bring me back to the login screen. I originally thought this was because of the drivers and possibly something broken, but after googling around I found out that if you set a cursor to something that isnt default this happens. Once I set the cursor back to default everything runs as smooth as ever.

On a last note, Im pretty sure that my Nvidia drivers are working and that my system is running off of them. However there is a slight chance that it is just running on my Intel card so what I did is I left my Windows that came on the system installed on the 256Gb solid state drive and installed Sabayon on the 1Tb hard drive.

I hope this made things a little more streamed lined for you, and you dont have to go through three days of swearing and pulling your hair out to get Sabayon installed on your box. If there are any questions feel free to [contact](../contact.html) me or leave comments when I finally get the comment section up.
